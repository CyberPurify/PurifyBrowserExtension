<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mqtt</title>
</head>

<body>

    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
        // Initialize a mqtt variable globally
        var mqtt_url = new URL('mqtt://chrome_ext:@10.148.0.7:1883');
        var auth = (mqtt_url.auth || ':').split(':');
        var url = "mqtt://" + mqtt_url.host;

        //username: auth[0] + ":" + auth[0] if you are on a shared instance
        var options = {
            path: '/ws',
            clientId: 'chrome_ext_' + Math.random().toString(16).substr(2, 8),
            username: 'chrome_ext',
            password: '3oKdFYHg4j1JUuYsGp93iuH21c7j3XTP',
        };

        // Create a client connection
        var client = mqtt.connect("ws://10.148.0.7:15675", options);

        client.on('connect', function () {

            console.log("connected");

            //client.subscribe('hello/world', function () {
            //  client.on('message', function (topic, message, packet) {
            //    console.log("Received '" + message + "' on '" + topic + "'");
            //});
            //});

            // publish a message to a topic
            var message = JSON.stringify({
                'device': '1234-1234-1234-1234'
            })

            // publish a message to a topic
            client.publish('mqtt_proxy', message, function () {
                console.log("Message is published");
                //client.end(); // Close the connection when published
            });
        });
    </script>
</body>

</html>